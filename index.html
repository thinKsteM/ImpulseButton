<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>欲ボタン</title>
    <link rel="stylesheet" href="styles.css">

    <link rel="manifest" href="/manifest.webmanifest">
    <meta name="theme-color" content="#111111">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="/icons/icon-192.png">
</head>

<body>
    <div id="app" class="app-container">
        <!-- Views will be injected here or toggled -->

        <!-- HOME VIEW -->
        <div id="view-home" class="view-container">
            <div class="header">
                <h1 class="header-title">欲ボタン</h1>
                <div class="header-buttons">
                    <button class="btn-reset-history">履歴をリセット</button>
                    <button class="btn-settings" title="編集モード">⚙️</button>
                </div>
            </div>

            <div id="header-stats" class="header-stats">
                <div class="stat-item patience">
                    <span class="stat-label">我慢した</span>
                    <span class="stat-value" id="stat-patience">0</span>
                </div>
                <div class="stat-item desire">
                    <span class="stat-label">我慢できなかった</span>
                    <span class="stat-value" id="stat-desire">0</span>
                </div>
            </div>

            <div id="home-content" class="content">
                <!-- Content injected via JS -->
            </div>
        </div>
    </div>

    <!-- ADD VIEW -->
    <div id="view-add" class="view-container hidden">
        <div class="header">
            <div class="header-actions">
                <button class="btn btn-ghost btn-icon nav-back">
                    <svg class="icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="m12 19-7-7 7-7" />
                        <path d="M19 12H5" />
                    </svg>
                </button>
                <h1 class="header-title" style="font-size: 1.25rem; margin-left: 0.5rem;">新しい欲ボタンを作成</h1>
            </div>
        </div>

        <form id="add-form" class="content">
            <!-- Image Upload -->
            <div class="form-group">
                <label class="form-label">表示する画像<span class="required">*</span></label>
                <p class="form-hint">なりたくない姿、理想の姿、推しのキャラなど、ボタンを押したときに表示する画像</p>
                <div class="image-upload-box" id="image-upload-area">
                    <input type="file" id="input-image" accept="image/*" class="file-input">
                    <div id="upload-placeholder" class="upload-placeholder">
                        <svg class="icon" style="width: 2rem; height: 2rem;" xmlns="http://www.w3.org/2000/svg"
                            width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                            <polyline points="17 8 12 3 7 8" />
                            <line x1="12" x2="12" y1="3" y2="15" />
                        </svg>
                        <span>タップして画像を選択</span>
                    </div>
                    <img id="image-preview" class="preview-image hidden" src="" alt="Preview">
                </div>
                <p id="error-image" class="error-text hidden"></p>
            </div>

            <!-- Name Input -->
            <div class="form-group">
                <label class="form-label">欲の名前<span class="required">*</span></label>
                <input type="text" id="input-name" class="input" placeholder="例：食べたい、買いたい、酒飲みたい" maxlength="20">
                <p id="error-name" class="error-text hidden"></p>
                <p class="char-count"><span id="count-name">0</span>/20</p>
            </div>

            <!-- Message Input -->
            <div class="form-group">
                <label class="form-label">表示メッセージ<span class="required">*</span></label>
                <p class="form-hint">この欲が出たときの自分に見せたいメッセージを入力</p>
                <textarea id="input-message" class="textarea" rows="5" placeholder="例：君ならできる！、本当に後悔しない？"
                    maxlength="200"></textarea>
                <p id="error-message" class="error-text hidden"></p>
                <p class="char-count"><span id="count-message">0</span>/200</p>
            </div>

            <!-- Color Selection -->
            <div class="form-group">
                <label class="form-label">ボタンの色</label>
                <div class="color-selector" id="color-selector">
                    <!-- Generated by JS or Hardcoded -->
                    <div class="color-option selected" data-color="0"
                        style="background: linear-gradient(to bottom, #00aaff, #0055aa);"></div>
                    <div class="color-option" data-color="1"
                        style="background: linear-gradient(to bottom, #ffaa00, #cc6600);"></div>
                    <div class="color-option" data-color="2"
                        style="background: linear-gradient(to bottom, #55dd00, #228800);"></div>
                    <div class="color-option" data-color="3"
                        style="background: linear-gradient(to bottom, #ff66cc, #cc0066);"></div>
                    <div class="color-option" data-color="4"
                        style="background: linear-gradient(to bottom, #ffee00, #ddaa00);"></div>
                    <div class="color-option" data-color="5"
                        style="background: linear-gradient(to bottom, #ff5555, #aa0000);"></div>
                    <div class="color-option" data-color="6"
                        style="background: linear-gradient(to bottom, #aa55ff, #5500aa);"></div>
                    <div class="color-option" data-color="7"
                        style="background: linear-gradient(to bottom, #00eeee, #009999);"></div>
                </div>
            </div>

            <div
                style="margin-top: auto; padding-top: 1rem; border-top: 1px solid var(--border); display: flex; gap: 0.5rem;">
                <button type="button" class="btn btn-outline nav-back" style="flex:1">キャンセル</button>
                <button type="submit" class="btn btn-primary" style="flex:1">保存</button>
            </div>
        </form>
    </div>

    <!-- BUTTON FLOW: IMAGE VIEW -->
    <div id="view-button-image" class="view-container view-gradient-bg hidden">
        <img id="flow-image" src="" alt="" class="full-screen-image">
        <p class="tap-overlay-text">タップして次へ</p>
    </div>

    <!-- BUTTON FLOW: MESSAGE VIEW -->
    <div id="view-button-message" class="view-container hidden">
        <div class="header">
            <div class="header-actions">
                <button id="btn-flow-back" class="btn btn-ghost btn-icon">
                    <svg class="icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="m12 19-7-7 7-7" />
                        <path d="M19 12H5" />
                    </svg>
                </button>

            </div>
        </div>

        <div class="content">
            <div style="margin-bottom: 1.5rem; padding-bottom: 1.5rem; border-bottom: 1px solid var(--border);">

                <p id="flow-name" style="font-size: 1.5rem; font-weight: 700; color: var(--foreground);"></p>
            </div>

            <div style="margin-bottom: 2rem; padding-bottom: 1.5rem; border-bottom: 1px solid var(--border);">

                <div class="message-box">
                    <p id="flow-message" style="color: var(--card-foreground);"></p>
                </div>
            </div>

            <!-- Per Button Stats -->
            <!-- Per Button Stats -->
            <div class="flow-stats">
                <p class="flow-stat-label">これまでの履歴</p>
                <div class="flow-stat-row">
                    <div class="flow-stat-item">
                        <span class="stat-label">我慢した</span>
                        <span class="flow-stat-val-patience"><b id="flow-stat-patience">0</b>回</span>
                    </div>
                    <div class="flow-stat-item">
                        <span class="stat-label">欲望に負けた</span>
                        <span class="flow-stat-val-desire"><b id="flow-stat-desire">0</b>回</span>
                    </div>
                </div>
            </div>

            <div style="margin-top: auto;">

                <div style="margin-top: auto;">
                    <p
                        style="font-size: 1.5rem; font-weight: 700; margin-bottom: 1.5rem; text-align: center; text-shadow: 0 2px 4px rgba(0,0,0,0.5);">
                        どうする？</p>
                    <div class="grid-2" style="margin-bottom: 1rem;">
                        <button id="btn-flow-do" class="btn btn-destructive btn-outline" style="padding: 1rem;">
                            <span class="btn-main-text">やる</span><br><span style="font-weight: normal;">(我慢できない)</span>
                        </button>
                        <button id="btn-flow-dont" class="btn btn-primary" style="padding: 1rem;">
                            <span class="btn-main-text">やらない</span><br><span style="font-weight: normal;">(我慢する)</span>
                        </button>
                    </div>
                    <button id="btn-flow-home" class="btn btn-ghost" style="width: 100%;">
                        <svg class="icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                            fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round" style="margin-right: 0.5rem;">
                            <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
                            <polyline points="9 22 9 12 15 12 15 22" />
                        </svg>
                        ホームに戻る
                    </button>
                </div>
            </div>
        </div>

    </div>
    <script src="app.js"></script>
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js').catch(console.error);
            });
        }
    </script>

</body>

</html>